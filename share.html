<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Share Image as File Example</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 24px; }
    button { padding: 10px 14px; border-radius: 10px; border: 1px solid #ccc; cursor: pointer; }
    img { max-width: 260px; display:block; margin-bottom: 12px; }
    .hint { color:#666; font-size: 14px; }
  </style>
</head>
<body>

  <!-- Image to be shared -->
  <img id="pic" src="https://t4.ftcdn.net/jpg/00/53/45/31/360_F_53453175_hVgYVz0WmvOXPd9CNzaUcwcibiGao3CL.jpg" alt="Share image" crossorigin="anonymous"/>

  <button id="shareBtn">Share as File</button>
  <p class="hint" id="status"></p>

  <!-- Fallback if file sharing is not supported -->
  <div id="fallback" style="display:none; margin-top:10px;">
    <a id="dl" download="photo.jpg">Download Image (manual share)</a><br>
    <a id="wa" target="_blank" rel="noopener">Send to WhatsApp (link only)</a>
  </div>

<script>
(async function () {
  const img = document.getElementById('pic');
  const btn = document.getElementById('shareBtn');
  const status = document.getElementById('status');
  const fallback = document.getElementById('fallback');
  const dl = document.getElementById('dl');
  const wa = document.getElementById('wa');

  // WhatsApp link fallback (text-based, not file)
  wa.href = 'https://wa.me/?text=' + encodeURIComponent(window.location.href);

  /**
   * Convert image element to a File object (fetch → Blob → File)
   */
  async function imageToFile(imgEl) {
    if (!imgEl.complete)
      await new Promise(r => { imgEl.onload = r; imgEl.onerror = r; });

    const res = await fetch(imgEl.src, { mode: 'cors' });
    if (!res.ok) throw new Error('Failed to fetch image: ' + res.status);
    const blob = await res.blob();

    const ext = (blob.type.includes('png')) ? 'png'
               : (blob.type.includes('webp')) ? 'webp'
               : 'jpg';
    const fileName = `shared-image.${ext}`;
    return new File([blob], fileName, { type: blob.type || 'image/jpeg', lastModified: Date.now() });
  }

  /**
   * Check if current browser supports file sharing
   */
  async function canShareFilesWith(file) {
    if (!('share' in navigator)) return false;
    if ('canShare' in navigator) {
      try { return navigator.canShare({ files: [file] }); }
      catch { return false; }
    }
    return false;
  }

  /**
   * Main share button handler
   */
  btn.addEventListener('click', async () => {
    status.textContent = '';
    try {
      const file = await imageToFile(img);
      const supported = await canShareFilesWith(file);

      if (!supported) {
        // Show fallback if file sharing is unavailable
        const blobUrl = URL.createObjectURL(file);
        dl.href = blobUrl;
        fallback.style.display = 'block';
        status.textContent = 'File sharing not supported. Fallback enabled.';
        return;
      }

      await navigator.share({
        files: [file],
        title: 'Shared Image',
        text: '' // leave empty so some apps don’t override with link
      });

      status.textContent = 'Shared successfully ✅';
    } catch (err) {
      console.error(err);
      status.textContent = 'Share failed: ' + (err.message || err);
    }
  });

})();
</script>
</body>
</html>
